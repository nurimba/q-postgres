'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _execute=require('./execute'),_execute2=_interopRequireDefault(_execute),_sqlSelect=require('../sql/sqlSelect'),_sqlSelect2=_interopRequireDefault(_sqlSelect),_sqlUtils=require('../sql/sqlUtils');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}return info.done?void resolve(value):Promise.resolve(value).then(function(value){return step('next',value)},function(err){return step('throw',err)})}return step('next')})}}var comparators={eq:'=',// equal
lt:'<',// less than
gt:'>',// greater than
lq:'<=',// less or equal
gq:'>=',// greater or equal
df:'<>',// diference
lk:'like'// = like by argument
},condToWhereList=function condToWhereList(a){var b=1>=arguments.length||void 0===arguments[1]?[]:arguments[1];return Object.keys(a).forEach(function(c){var d=void 0,e=a[c],f='=',g=e.split(':');if(2===g.length){var i=(g[0]+'').toLowerCase().trim();comparators.hasOwnProperty(i)&&(e=(g[1]+'').trim(),f=comparators[i],'like'==f&&(e='%'+e+'%'))}var h=c.split('.');2===h.length&&(d=(h[0]+'').trim(),c=(h[1]+'').trim()),b.push({field:c,comparator:f,value:e,table:d})}),b};exports.default=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(a,b,c){var d,e,f;return regeneratorRuntime.wrap(function _callee$(_context){for(;1;)switch(_context.prev=_context.next){case 0:return d=condToWhereList(c),e=(0,_sqlUtils.objToListFields)(a),f=(0,_sqlSelect2.default)(Object.assign({},a,{select:e,where:d})),_context.abrupt('return',(0,_execute2.default)(a,b,f));case 2:case'end':return _context.stop();}},_callee,void 0)}));return function(_x2,_x3,_x4){return _ref.apply(this,arguments)}}();