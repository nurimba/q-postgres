'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _pg=require('pg');function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}return info.done?void resolve(value):Promise.resolve(value).then(function(value){return step('next',value)},function(err){return step('throw',err)})}return step('next')})}}var BEGIN='BEGIN',COMMIT='COMMIT',ROLLBACK='ROLLBACK',getConnection=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(a){var b,c;return regeneratorRuntime.wrap(function _callee$(_context){for(;1;)switch(_context.prev=_context.next){case 0:return _context.next=2,a.connect();case 2:if(b=_context.sent,c=b.errno,!c){_context.next=6;break}throw new Error(b.message);case 6:return _context.abrupt('return',b);case 7:case'end':return _context.stop();}},_callee,void 0)}));return function getConnection(_x){return _ref.apply(this,arguments)}}(),runSql=function runSql(a,b){return new Promise(function(c,d){a.query(b,function(e,f){return e?d(e):void c(f)})})},factoryConnection=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(a){var b;return regeneratorRuntime.wrap(function _callee3$(_context3){for(;1;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,getConnection(a);case 2:return b=_context3.sent,_context3.abrupt('return',{release:function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function _callee2$(_context2){for(;1;)switch(_context2.prev=_context2.next){case 0:return _context2.abrupt('return',b.release());case 1:case'end':return _context2.stop();}},_callee2,void 0)}));return function release(){return _ref3.apply(this,arguments)}}(),execute:runSql.bind(void 0,b),commit:runSql.bind(void 0,b,COMMIT),rollback:runSql.bind(void 0,b,ROLLBACK),startTransaction:runSql.bind(void 0,b,BEGIN)});case 4:case'end':return _context3.stop();}},_callee3,void 0)}));return function factoryConnection(_x2){return _ref2.apply(this,arguments)}}();exports.default=function(a){var b=new _pg.Pool(a),c=factoryConnection.bind(void 0,b);return{connect:c}};