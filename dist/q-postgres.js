module.exports=function(e){function t(r){if(n[r])return n[r].exports;var u=n[r]={exports:{},id:r,loaded:!1};return e[r].call(u.exports,u,u.exports,t),u.loaded=!0,u.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.genSQL=t.types=void 0;var u=n(28),a=n(23),i=r(a),o=n(13),f=r(o),d=n(5),s=r(d),l=n(4),c=r(l);t.types=s["default"],t.genSQL=c["default"];t["default"]=function(e){var t=new u.Pool(e),n=f["default"].bind(void 0,t,e);return{connect:n,orm:i["default"],pool:t}}},function(e,t){e.exports=require("babel-runtime/core-js/object/keys")},function(e,t){e.exports=require("babel-runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("babel-runtime/regenerator")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.selectTable=t.deleteTable=t.updateTable=t.insertTable=t.createTable=t.alterTable=t.dropTable=void 0;var u=n(17),a=r(u),i=n(14),o=r(i),f=n(15),d=r(f),s=n(18),l=r(s),c=n(20),p=r(c),v=n(16),b=r(v),E=n(19),h=r(E),m=t.dropTable=a["default"],T=t.alterTable=o["default"],x=t.createTable=d["default"],N=t.insertTable=l["default"],R=t.updateTable=p["default"],g=t.deleteTable=b["default"],O=t.selectTable=h["default"];t["default"]={dropTable:m,alterTable:T,createTable:x,insertTable:N,updateTable:R,deleteTable:g,selectTable:O}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=t.TEXT="TEXT",r=t.CITEXT="CITEXT",u=t.NAME="VARCHAR(255)",a=t.DATE="DATE",i=t.JSON="JSON",o=t.CHAR1="CHAR(1)",f=t.CHAR2="CHAR(2)",d=t.CHAR8="CHAR(8)",s=t.EMAIL="VARCHAR(50)",l=t.PHONE="VARCHAR(30)",c=t.MONEY="NUMERIC(15,2)",p=t.STRING="VARCHAR(255)",v=t.SELECT="VARCHAR(25)",b=t.BOOLEAN="BOOLEAN",E=t.INTEGER="INTEGER",h=t.SMALLINT="SMALLINT",m=t.CPFCNPJ="VARCHAR(14)",T=t.PERCENT="NUMERIC(15,8)",x=t.PRIMARY="SERIAL PRIMARY KEY",N=t.DATETIME="TIMESTAMP",R=t.REFERENCES="REFERENCES",g=t.NOT_NULL="NOT NULL";t["default"]={TEXT:n,DATE:a,JSON:i,NAME:u,CHAR1:o,CHAR2:f,CHAR8:d,EMAIL:s,PHONE:l,MONEY:c,STRING:p,SELECT:v,CITEXT:r,BOOLEAN:b,INTEGER:E,CPFCNPJ:m,PERCENT:T,PRIMARY:x,DATETIME:N,SMALLINT:h,NOT_NULL:g,REFERENCES:R}},function(e,t){e.exports=require("babel-runtime/core-js/object/assign")},function(e,t){e.exports=require("babel-runtime/helpers/defineProperty")},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={eq:"=",lt:"<",gt:">",lq:"<=",gq:">=",df:"<>",lk:"like","==":"=","<<":"<",">>":">","<=":"<=",">=":">=","<>":"<>","%%":"like"};t["default"]=function(e){var t=n.eq;if("string"!=typeof e)return{comparator:t,value:e};var r=e.split(":"),u=r.shift();if(!n.hasOwnProperty(u))return{comparator:t,value:e};t=n[u];var a=r.join(":").trim();return{comparator:t,value:"like"===t?"%"+a+"%":a}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.formatInteger=t.formatFloat=t.formatDate=void 0;var u=n(7),a=r(u),i=n(6),o=r(i),f=n(1),d=r(f),s=n(5),l=t.formatDate=function(e){if(!e||!String(e).trim())return null;var t=new Date(e),n=("0"+t.getDate()).substr(-2),r=("0"+(t.getMonth()+1)).substr(-2);return t.getFullYear()+"-"+r+"-"+n},c=t.formatFloat=function(e){return e&&String(e).trim()?parseFloat(e):null},p=t.formatInteger=function(e){return e&&String(e).trim()?parseInt(e,10):null};t["default"]=function(e,t){var n={};return(0,d["default"])(e.fields).forEach(function(r){var u=t[r.toLowerCase()];e.fields[r]===s.DATE&&(u=l(u)),[s.MONEY,s.PERCENT].indexOf(e.fields[r])>-1&&(u=c(u)),[s.INTEGER,s.REFERENCES].indexOf(e.fields[r])>-1&&(u=p(u)),(0,o["default"])(n,(0,a["default"])({},r,u))}),n}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(3),a=r(u),i=n(2),o=r(i),f=n(1),d=r(f),s=n(4);t["default"]=function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),u=2;u<n;u++)r[u-2]=arguments[u];r&&r.length||(r=(0,d["default"])(t.fields));var i=(0,s.selectTable)();return i.from(t.table),r.forEach(function(e){return i.field(e)}),i.run=(0,o["default"])(a["default"].mark(function f(){var t,n;return a["default"].wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=i.values,n=i.toSQL(),r.abrupt("return",e.execute(n,t));case 3:case"end":return r.stop()}},f,void 0)})),i}},function(e,t){e.exports=require("babel-runtime/core-js/promise")},function(e,t){e.exports=require("babel-runtime/helpers/typeof")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(11),a=r(u),i=n(3),o=r(i),f=n(2),d=r(f),s="BEGIN",l="COMMIT",c="ROLLBACK",p=function(){var e=(0,d["default"])(o["default"].mark(function t(e){var n,r;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.connect();case 2:if(n=t.sent,r=n.errno,!r){t.next=6;break}throw new Error(n.message);case 6:return t.abrupt("return",n);case 7:case"end":return t.stop()}},t,void 0)}));return function(t){return e.apply(this,arguments)}}(),v=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return new a["default"](function(r,u){e.query(t,n,function(a,i){return e.config.debug&&console.log("                          "),e.config.debug&&console.log("--------------------------"),e.config.debug&&console.log(t),e.config.debug&&t&&console.log(t),e.config.debug&&n&&console.log(n),e.config.debug&&a&&console.log("ERROR: ",a),e.config.debug&&i&&console.log("RESULT: ",i),e.config.debug&&console.log("--------------------------"),e.config.debug&&console.log("                          "),a?u(a):void r(i)})})};t["default"]=function(){var e=(0,d["default"])(o["default"].mark(function t(e,n){var r,u;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p(e);case 2:return r=t.sent,r.config=n,u={release:function(){var e=(0,d["default"])(o["default"].mark(function t(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.release());case 1:case"end":return e.stop()}},t,void 0)}));return function(){return e.apply(this,arguments)}}(),execute:v.bind(void 0,r),commit:function(){var e=(0,d["default"])(o["default"].mark(function t(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(r,l);case 2:return e.abrupt("return",u);case 3:case"end":return e.stop()}},t,void 0)}));return function(){return e.apply(this,arguments)}}(),rollback:function(){var e=(0,d["default"])(o["default"].mark(function t(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(r,c);case 2:return e.abrupt("return",u);case 3:case"end":return e.stop()}},t,void 0)}));return function(){return e.apply(this,arguments)}}(),startTransaction:function(){var e=(0,d["default"])(o["default"].mark(function t(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(r,s);case 2:return e.abrupt("return",u);case 3:case"end":return e.stop()}},t,void 0)}));return function(){return e.apply(this,arguments)}}()},t.abrupt("return",u);case 6:case"end":return t.stop()}},t,void 0)}));return function(t,n){return e.apply(this,arguments)}}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(12),a=r(u),i=n(5),o="\n",f=function(e,t,n,r,u,o){var f=t.adds,d="",s="";return u&&(d=" NOT NULL"),void 0!==o&&(s=["boolean","number",""].indexOf("undefined"==typeof o?"undefined":(0,a["default"])(o))>-1?" DEFAULT "+String(o).toUpperCase():" DEFAULT '"+o+"'"),f.push("ADD COLUMN "+n+" "+(r===i.REFERENCES?i.INTEGER:r)+d+s),e},d=function(e,t,n){var r=t.drops;return r.push("DROP COLUMN "+n+" RESTRICT"),e},s=function(e,t,n){var r=t.alters;return r.push("ALTER COLUMN "+n+" DROP DEFAULT"),e},l=function(e,t,n,r){var u=t.alters,i="";return void 0!==r&&(i=["boolean","number",""].indexOf("undefined"==typeof r?"undefined":(0,a["default"])(r))>-1?""+String(r).toUpperCase():"'"+r+"'"),u.push("ALTER COLUMN "+n+" SET DEFAULT "+i),e},c=function(e){var t=e.tableName,n=e.adds,r=e.alters,u=e.drops,a=e.indexs;return("\nALTER TABLE "+t+"\n  "+n.concat(r,u,a).join(","+o+"  ")+";\n").trim()},p=function(e,t,n,r){var u=t.alters;return u.push("ALTER COLUMN "+n+" TYPE "+(r===i.REFERENCES?i.INTEGER:r)),e},v=function(e,t,n){var r=t.alters;return r.push("ALTER COLUMN "+n+" DROP NOT NULL"),e},b=function(e,t,n){var r=t.alters;return r.push("ALTER COLUMN "+n+" SET NOT NULL"),e},E=function(e,t,n,r){var u=t.alters;return u.push("RENAME COLUMN "+n+" TO "+r),e},h=function(e,t,n){var r=t.tableName,u=t.indexs;return u.push("ADD CONSTRAINT unique_"+r+"_"+n+" UNIQUE ("+n+")"),e},m=function(e,t,n){var r=t.tableName,u=t.indexs;return u.push("DROP CONSTRAINT unique_"+r+"_"+n),e},T=function(e,t,n,r,u){var a=t.tableName,i=t.indexs;return i.push("ADD CONSTRAINT foreign_"+a+"_"+n+" FOREIGN KEY ("+n+") REFERENCES "+r+" ("+(u?u:"id")+")"),e},x=function(e,t,n){var r=t.tableName,u=t.indexs;return u.push("DROP CONSTRAINT foreign_"+r+"_"+n),e};t["default"]=function(e){var t={tableName:e,adds:[],drops:[],alters:[],indexs:[]},n={};return n.toSQL=c.bind(void 0,t),n.setType=p.bind(void 0,n,t),n.addColumn=f.bind(void 0,n,t),n.addUnique=h.bind(void 0,n,t),n.dropUnique=m.bind(void 0,n,t),n.dropColumn=d.bind(void 0,n,t),n.setDefault=l.bind(void 0,n,t),n.setNotNull=b.bind(void 0,n,t),n.dropNotNull=v.bind(void 0,n,t),n.dropDefault=s.bind(void 0,n,t),n.renameColumn=E.bind(void 0,n,t),n.addForeign=T.bind(void 0,n,t),n.dropForeign=x.bind(void 0,n,t),n}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(12),a=r(u),i=n(5),o="\n",f=function(e,t,n,r,u,o){var f=t.columns,d="",s="";return u&&(d=" NOT NULL"),void 0!==o&&(s=["boolean","number",""].indexOf("undefined"==typeof o?"undefined":(0,a["default"])(o))>-1?" DEFAULT "+String(o).toUpperCase():" DEFAULT '"+o+"'"),f.push(n+" "+(r===i.REFERENCES?i.INTEGER:r)+d+s),e},d=function(e,t,n){var r=t.tableName,u=t.uniques;return u.push("CONSTRAINT unique_"+r+"_"+n+" UNIQUE ("+n+")"),e},s=function(e,t,n,r,u){var a=t.tableName,i=t.foreigns;return i.push("CONSTRAINT foreign_"+a+"_"+n+" FOREIGN KEY ("+n+") REFERENCES "+r+" ("+(u?u:"id")+")"),e},l=function(e){var t=e.tableName,n=e.columns,r=e.uniques,u=e.foreigns;return("\nCREATE TABLE "+t+" (\n  "+n.concat(r,u).join(","+o+"  ")+"\n);\n").trim()};t["default"]=function(e){var t={tableName:e,columns:[],uniques:[],foreigns:[]},n={};return n.toSQL=l.bind(void 0,t),n.unique=d.bind(void 0,n,t),n.column=f.bind(void 0,n,t),n.foreign=s.bind(void 0,n,t),n}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(1),a=r(u),i=n(8),o=r(i),f="\n",d=function(e){var t=e.schema,n=e.conditions,r=t.table,u=t.fields,i=n&&n.length?f+"WHERE ("+n.join(")"+f+"  AND (")+")":"";return("\nDELETE FROM "+r+i+"\nRETURNING "+(0,a["default"])(u).join(", ")+";\n").trim()},s=function(e,t){return e.values=[],e.conditions=(0,a["default"])(t||{}).map(function(n,r){var u=(0,o["default"])(t[n]),a=u.comparator,i=u.value;return e.values.push(i),n+" "+a+" $"+(r+1)}),e};t["default"]=function(e){var t={schema:e,values:[],conditions:[]};return t.toSQL=d.bind(void 0,t),t.objValues=s.bind(void 0,t),t}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return("\nDROP TABLE "+e+";\n").trim()};t["default"]=function(e){var t={};return t.toSQL=n.bind(void 0,e),t}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(1),a=r(u),i=function(e){var t=e.schema,n=e.listFields,r=e.paramters,u=t.table,i=t.fields;return("\nINSERT INTO "+u+" ("+n.join(", ")+")\nVALUES ("+r.join(", ")+")\nRETURNING "+(0,a["default"])(i).join(", ")+";\n").trim()},o=function(e,t){var n=e.schema,r=n.fields;return e.listFields=(0,a["default"])(t).filter(function(e){return r.hasOwnProperty(e)&&void 0!==t[e]}),e.values=e.listFields.map(function(e){return t[e]}),e.paramters=e.listFields.map(function(e,t){return"$"+(t+1)}),e};t["default"]=function(e){var t={schema:e,values:{}};return t.toSQL=i.bind(void 0,t),t.objValues=o.bind(void 0,t),t}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(1),a=r(u),i=n(6),o=r(i),f=n(8),d=r(f),s="\n",l=function(e,t,n){return n||(n=""),e.order.push((t+" "+n.toUpperCase()).trim()),e},c=function(e,t){return e.fields.push(t),e},p=function(e,t){return e.group.push(t),e},v=function(e,t){return e.joins.push(t),e},b=function(e,t){return(0,o["default"])(e,{tableName:t})},E=function(e,t){return(0,o["default"])(e,{limitRows:t})},h=function(e,t){return(0,o["default"])(e,{skipRows:t})},m=function N(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{c:0};return(0,a["default"])(e).map(function(r){var u=e[r];if("$or"===r.toLowerCase())return"("+N(u,t,n).join(") OR (")+")";n.c++;var a=(0,d["default"])(u),i=a.comparator,o=a.value;return t.push(o),r+" "+i+" $"+n.c})},T=function(e,t){return t||(t={}),e.conditions=m(t,e.values),e},x=function(e){var t=e.tableName,n=e.fields,r=e.order,u=e.group,a=e.conditions,i=e.limitRows,o=e.skipRows,f=e.joins,d=o?s+"OFFSET "+o:"",l=i?s+"LIMIT "+i:"",c=r&&r.length?s+"ORDER BY "+r.join(", "):"",p=u&&u.length?s+"GROUP BY "+u.join(", "):"",v=a&&a.length?s+"WHERE ("+a.join(")"+s+"  AND (")+")":"",b=f&&f.length?""+s+f.join(s):"";return("\nSELECT "+n.join(", ")+"\nFROM "+t+b+v+p+c+l+d+"\n  ").trim()};t["default"]=function(){var e={tableName:"",fields:[],order:[],group:[],values:[],joins:[]};return e.from=b.bind(void 0,e),e.join=v.bind(void 0,e),e.skip=h.bind(void 0,e),e.limit=E.bind(void 0,e),e.field=c.bind(void 0,e),e.toSQL=x.bind(void 0,e),e.where=T.bind(void 0,e),e.orderBy=l.bind(void 0,e),e.groupBy=p.bind(void 0,e),e}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(1),a=r(u),i=n(8),o=r(i),f="\n",d=function(e){var t=e.schema,n=e.paramters,r=e.conditions,u=t.table,i=t.fields,o=r&&r.length?f+"WHERE ("+r.join(")"+f+"  AND (")+")":"";return("\nUPDATE "+u+" SET\n  "+n.join(","+f+"  ")+o+"\nRETURNING "+(0,a["default"])(i).join(", ")+";\n").trim()},s=function(e,t,n){var r=e.schema,u=r.fields,i=(0,a["default"])(t).filter(function(e){return u.hasOwnProperty(e)&&void 0!==t[e]});return e.values=i.map(function(e){return t[e]}),e.paramters=i.map(function(e,t){return e+" = $"+(t+1)}),e.conditions=(0,a["default"])(n||{}).map(function(t,r){var u=(0,o["default"])(n[t]),a=u.comparator,f=u.value;return e.values.push(f),t+" "+a+" $"+(i.length+r+1)}),e};t["default"]=function(e){var t={schema:e,values:[],conditions:[]};return t.toSQL=d.bind(void 0,t),t.objValues=s.bind(void 0,t),t}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(3),a=r(u),i=n(2),o=r(i),f=n(4),d=n(9),s=r(d);t["default"]=function(){var e=(0,o["default"])(a["default"].mark(function t(e,n,r){var u,i,o,d,l;return a["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return u=(0,f.deleteTable)(n).objValues(r),i=u.values,o=u.toSQL(),t.next=5,e.execute(o,i);case 5:if(d=t.sent,l=d.rows,l&&l.length){t.next=9;break}return t.abrupt("return",void 0);case 9:return t.abrupt("return",l.map(s["default"].bind(void 0,n)).shift());case 10:case"end":return t.stop()}},t,void 0)}));return function(t,n,r){return e.apply(this,arguments)}}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(27),a=r(u),i=n(3),o=r(i),f=n(7),d=r(f),s=n(1),l=r(s),c=n(11),p=r(c),v=n(2),b=r(v),E=n(10),h=r(E),m=n(9),T=r(m),x=function(){var e=(0,b["default"])(o["default"].mark(function t(e,n,r,u,a){var i;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=r.hasMany,t.next=3,p["default"].all((0,l["default"])(i||{}).map(function(){var t=(0,b["default"])(o["default"].mark(function r(t){var f,s,l,c,v,b,E;return o["default"].wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return f=i[t],s=f.table,l=f.field,c=e[s],v=h["default"].bind(void 0,n,c),r.next=7,v("id").where((0,d["default"])({},l,u.id)).run();case 7:if(b=r.sent,E=b.rows,E&&E.length){r.next=11;break}return r.abrupt("return");case 11:return r.next=13,p["default"].all(E.map(function(t){var r=t.id;return R(e,n,c,r,a)}));case 13:u[t]=r.sent;case 14:case"end":return r.stop()}},r,void 0)}));return function(e){return t.apply(this,arguments)}}()));case 3:case"end":return t.stop()}},t,void 0)}));return function(t,n,r,u,a){return e.apply(this,arguments)}}(),N=function(){var e=(0,b["default"])(o["default"].mark(function t(e,n,r,u,i){var f;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return f=r.manyToMany,t.next=3,p["default"].all((0,l["default"])(f||{}).map(function(){var t=(0,b["default"])(o["default"].mark(function r(t){var s,c,v,E,m,T,x,N,g,O,w;return o["default"].wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s=f[t],c=s.table,v=s.primary,E=s.secondary,m=s.extraFields,T=s.schema,x=e[c],N=h["default"].bind(void 0,n,x),g=(0,l["default"])(m),r.next=11,N.apply(void 0,[E].concat((0,a["default"])(g))).where((0,d["default"])({},v,u.id)).run();case 11:if(O=r.sent,w=O.rows,w&&w.length){r.next=15;break}return r.abrupt("return");case 15:return r.next=17,p["default"].all(w.map(function(){var t=(0,b["default"])(o["default"].mark(function r(t){var u,a;return o["default"].wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return u=t[E],r.next=3,R(e,n,e[T],u,i);case 3:return a=r.sent,g.forEach(function(e){return a[e]=t[e]}),r.abrupt("return",a);case 6:case"end":return r.stop()}},r,void 0)}));return function(e){return t.apply(this,arguments)}}()));case 17:u[t]=r.sent;case 18:case"end":return r.stop()}},r,void 0)}));return function(e){return t.apply(this,arguments)}}()));case 3:case"end":return t.stop()}},t,void 0)}));return function(t,n,r,u,a){return e.apply(this,arguments)}}(),R=function(){var e=(0,b["default"])(o["default"].mark(function t(e,n,r,u){var a,i,f,d,s,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=r.table+"-"+u,!l.hasOwnProperty(a)){t.next=3;break}return t.abrupt("return",l[a]);case 3:return i=h["default"].bind(void 0,n,r),t.next=6,i().where({id:u}).limit(1).run();case 6:if(f=t.sent,d=f.rows,d&&d.length){t.next=10;break}return t.abrupt("return",void 0);case 10:return s=d.map(T["default"].bind(void 0,r)).shift(),l[a]=s,t.next=14,x(e,n,r,s,l);case 14:return t.next=16,N(e,n,r,s,l);case 16:return t.abrupt("return",s);case 17:case"end":return t.stop()}},t,void 0)}));return function(t,n,r,u,a){return e.apply(this,arguments)}}(),g=function(){var e=(0,b["default"])(o["default"].mark(function t(e,n,r,u,a){var i,f,s,l,c;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=h["default"].bind(void 0,n,r),t.next=3,i("id").where((0,d["default"])({},u,a)).run();case 3:if(f=t.sent,s=f.rows,s&&s.length){t.next=7;break}return t.abrupt("return",[]);case 7:return l={},c=s.map(function(t){var u=t.id;return R(e,n,r,u,l)}),t.abrupt("return",p["default"].all(c));case 10:case"end":return t.stop()}},t,void 0)}));return function(t,n,r,u,a){return e.apply(this,arguments)}}(),O=function(e,t,n){var r={};return(0,l["default"])(n.fields).forEach(function(u){var a="findBy"+u.charAt(0).toUpperCase().concat(u.slice(1));return"id"===u?r[a]=R.bind(void 0,e,t,n):void(r[a]=g.bind(void 0,e,t,n,u))}),r};t["default"]=O},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(7),a=r(u),i=n(6),o=r(i),f=n(25),d=r(f),s=n(10),l=r(s),c=n(21),p=r(c),v=n(22),b=r(v),E=n(24),h=function T(e,t,n){var r=JSON.parse((0,d["default"])(e[n]));e[n].hasOwnProperty("afterSave")&&(r.afterSave=e[n].afterSave),e[n].hasOwnProperty("beforeSave")&&(r.beforeSave=e[n].beforeSave);var u=T.bind(void 0,e,t),a={schema:r};return a.select=l["default"].bind(void 0,t,r),a["delete"]=p["default"].bind(void 0,t,r),a.insert=E.insertData.bind(void 0,u,e,t,r),a.update=E.updateData.bind(void 0,u,e,t,r),(0,o["default"])(a,(0,b["default"])(e,t,r))},m=function(e,t){return h.bind(void 0,e,t)};t["default"]=function(e){var t={};return e.forEach(function(e){return(0,o["default"])(t,(0,a["default"])({},e.table,e))}),m.bind(void 0,t)}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.updateData=t.insertData=void 0;var u=n(3),a=r(u),i=n(7),o=r(i),f=n(6),d=r(f),s=n(26),l=r(s),c=n(1),p=r(c),v=n(11),b=r(v),E=n(2),h=r(E),m=n(4),T=n(10),x=r(T),N=n(9),R=r(N),g=function(){var e=(0,h["default"])(a["default"].mark(function t(e,n,r,u,i,f){var s,c=u.manyToMany;return a["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=i.id,t.abrupt("return",b["default"].all((0,p["default"])(c||{}).map(function(){var t=(0,h["default"])(a["default"].mark(function u(t){var v,E,m,T,N,R,g,O;return a["default"].wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(v=f[t],v&&v.length){u.next=3;break}return u.abrupt("return");case 3:return E=c[t],m=E.table,T=E.primary,N=E.secondary,R=E.schema,g=E.extraFields,O=n[R],u.next=12,b["default"].all(v.map(function(t,u){var a=(0,l["default"])({},t);(0,p["default"])(g).forEach(function(e){return delete a[e]});var i=a.id;return i?y(e,n,r,O,a,{id:i}):_(e,n,r,O,a)}));case 12:return i[t]=u.sent,u.next=15,b["default"].all(v.map(function(){var u=(0,h["default"])(a["default"].mark(function f(u,l){var c,v,b,E,h,R,O,w;return a["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return v={},(0,p["default"])(g).forEach(function(e){return v[e]=u[e]}),b=i[t][l].id,v[T]=s,v[N]=b,E=x["default"].bind(void 0,r,n[m]),a.next=8,E("id").from("kinships").where((c={},(0,o["default"])(c,T,s),(0,o["default"])(c,N,b),c)).limit(1).run();case 8:if(h=a.sent,R=h.rows,O=R&&R.length?R.shift().id:void 0,!O){a.next=17;break}return a.next=14,y(e,n,r,n[m],v,{id:O});case 14:a.t0=a.sent,a.next=20;break;case 17:return a.next=19,_(e,n,r,n[m],v);case 19:a.t0=a.sent;case 20:w=a.t0,(0,p["default"])(g).forEach(function(e){return(0,d["default"])(i[t][l],(0,o["default"])({},e,w[e]))});case 22:case"end":return a.stop()}},f,void 0)}));return function(e,t){return u.apply(this,arguments)}}()));case 15:case"end":return u.stop()}},u,void 0)}));return function(e){return t.apply(this,arguments)}}())));case 2:case"end":return t.stop()}},t,void 0)}));return function(t,n,r,u,a,i){return e.apply(this,arguments)}}(),O=function(){var e=(0,h["default"])(a["default"].mark(function t(e,n,r,u,i,f){var d,s=u.hasMany;return a["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return d=i.id,t.next=3,b["default"].all((0,p["default"])(s||{}).map(function(){var t=(0,h["default"])(a["default"].mark(function u(t){var c,p,v,E,h;return a["default"].wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(c=f[t],c&&c.length){u.next=3;break}return u.abrupt("return");case 3:return p=s[t],v=p.table,E=p.field,h=n[v],u.next=9,b["default"].all(c.map(function(t,u){var a=(0,l["default"])({},t,(0,o["default"])({},E,d)),i=a.id;return i?y(e,n,r,h,a,{id:i}):_(e,n,r,h,a)}));case 9:i[t]=u.sent;case 10:case"end":return u.stop()}},u,void 0)}));return function(e){return t.apply(this,arguments)}}()));case 3:case"end":return t.stop()}},t,void 0)}));return function(t,n,r,u,a,i){return e.apply(this,arguments)}}(),w=function(){var e=(0,h["default"])(a["default"].mark(function t(e,n,r,u,i,o){return a["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,O(e,n,r,u,i,o);case 2:return t.next=4,g(e,n,r,u,i,o);case 4:return t.abrupt("return",i);case 5:case"end":return t.stop()}},t,void 0)}));return function(t,n,r,u,a,i){return e.apply(this,arguments)}}(),_=t.insertData=function(){var e=(0,h["default"])(a["default"].mark(function t(e,n,r,u,i){var o,f,d,s,l,c,v,b,E;return a["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=void 0,!u.hasOwnProperty("beforeSave")){t.next=5;break}return t.next=4,u.beforeSave(i,e(u.table),e);case 4:o=t.sent;case 5:return o&&(0,p["default"])(o).length&&(i=o),f=(0,m.insertTable)(u).objValues(i),d=f.values,s=f.toSQL(),t.next=11,r.execute(s,d);case 11:if(l=t.sent,c=l.rows,c&&c.length){t.next=15;break}return t.abrupt("return",void 0);case 15:if(v=c.map(R["default"].bind(void 0,u)).shift(),b=void 0,!u.hasOwnProperty("afterSave")){t.next=21;break}return t.next=20,u.afterSave(v,e(u.table),e);case 20:b=t.sent;case 21:return b&&b.id&&(v=b),t.next=24,w(e,n,r,u,v,i);case 24:return E=t.sent,u.ignoreFields&&u.ignoreFields.forEach(function(e){return delete E[e]}),t.abrupt("return",E);case 27:case"end":return t.stop()}},t,void 0)}));return function(t,n,r,u,a){return e.apply(this,arguments)}}(),y=t.updateData=function(){var e=(0,h["default"])(a["default"].mark(function t(e,n,r,u,i,o){var f,d,s,l,c,v,b,E,h;return a["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(f=void 0,!u.hasOwnProperty("beforeSave")){t.next=5;break}return t.next=4,u.beforeSave(i,e(u.table),e);case 4:f=t.sent;case 5:return f&&(0,p["default"])(f).length&&(i=f),d=(0,m.updateTable)(u).objValues(i,o),s=d.values,l=d.toSQL(),t.next=11,r.execute(l,s);case 11:if(c=t.sent,v=c.rows,v&&v.length){t.next=15;break}return t.abrupt("return",void 0);case 15:if(b=v.map(R["default"].bind(void 0,u)).shift(),E=void 0,!u.hasOwnProperty("afterSave")){t.next=21;break}return t.next=20,u.afterSave(b,e(u.table),e);case 20:E=t.sent;case 21:return E&&E.id&&(b=E),t.next=24,w(e,n,r,u,b,i);case 24:return h=t.sent,u.ignoreFields&&u.ignoreFields.forEach(function(e){return delete h[e]}),t.abrupt("return",h);case 27:case"end":return t.stop()}},t,void 0)}));return function(t,n,r,u,a,i){return e.apply(this,arguments)}}()},function(e,t){e.exports=require("babel-runtime/core-js/json/stringify")},function(e,t){e.exports=require("babel-runtime/helpers/extends")},function(e,t){e.exports=require("babel-runtime/helpers/toConsumableArray")},function(e,t){e.exports=require("pg")}]);
//# sourceMappingURL=q-postgres.js.map