module.exports=function(e){function t(n){if(r[n])return r[n].exports;var u=r[n]={exports:{},id:n,loaded:!1};return e[n].call(u.exports,u,u.exports,t),u.loaded=!0,u.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.genSQL=t.types=void 0;var u=r(28),a=r(23),i=n(a),o=r(13),d=n(o),f=r(5),s=n(f),l=r(4),c=n(l);t.types=s["default"],t.genSQL=c["default"];t["default"]=function(e){var t=new u.Pool(e),r=d["default"].bind(void 0,t);return{connect:r,orm:i["default"],pool:t}}},function(e,t){e.exports=require("babel-runtime/core-js/object/keys")},function(e,t){e.exports=require("babel-runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("babel-runtime/regenerator")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.selectTable=t.deleteTable=t.updateTable=t.insertTable=t.createTable=t.alterTable=t.dropTable=void 0;var u=r(17),a=n(u),i=r(14),o=n(i),d=r(15),f=n(d),s=r(18),l=n(s),c=r(20),p=n(c),v=r(16),b=n(v),h=r(19),E=n(h),m=t.dropTable=a["default"],T=t.alterTable=o["default"],x=t.createTable=f["default"],R=t.insertTable=l["default"],N=t.updateTable=p["default"],w=t.deleteTable=b["default"],O=t.selectTable=E["default"];t["default"]={dropTable:m,alterTable:T,createTable:x,insertTable:R,updateTable:N,deleteTable:w,selectTable:O}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=t.TEXT="TEXT",n=t.CITEXT="CITEXT",u=t.NAME="VARCHAR(255)",a=t.DATE="DATE",i=t.CHAR1="CHAR(1)",o=t.CHAR2="CHAR(2)",d=t.CHAR8="CHAR(8)",f=t.EMAIL="VARCHAR(50)",s=t.PHONE="VARCHAR(30)",l=t.MONEY="NUMERIC(15,2)",c=t.STRING="VARCHAR(255)",p=t.SELECT="VARCHAR(25)",v=t.BOOLEAN="BOOLEAN",b=t.INTEGER="INTEGER",h=t.CPFCNPJ="VARCHAR(14)",E=t.PERCENT="NUMERIC(15,8)",m=t.PRIMARY="SERIAL PRIMARY KEY",T=t.DATETIME="TIMESTAMP",x=t.REFERENCES="REFERENCES",R=t.NOT_NULL="NOT NULL";t["default"]={TEXT:r,DATE:a,NAME:u,CHAR1:i,CHAR2:o,CHAR8:d,EMAIL:f,PHONE:s,MONEY:l,STRING:c,SELECT:p,BOOLEAN:v,INTEGER:b,CPFCNPJ:h,PERCENT:E,PRIMARY:m,DATETIME:T,REFERENCES:x,NOT_NULL:R,CITEXT:n}},function(e,t){e.exports=require("babel-runtime/core-js/object/assign")},function(e,t){e.exports=require("babel-runtime/helpers/defineProperty")},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={eq:"=",lt:"<",gt:">",lq:"<=",gq:">=",df:"<>",lk:"like","==":"=","<<":"<",">>":">","<=":"<=",">=":">=","<>":"<>","%%":"like"};t["default"]=function(e){var t=r.eq;if("string"!=typeof e)return{comparator:t,value:e};var n=e.split(":"),u=n.shift();if(!r.hasOwnProperty(u))return{comparator:t,value:e};t=r[u];var a=n.join(":").trim();return{comparator:t,value:"like"===t?"%"+a+"%":a}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.formatDate=void 0;var u=r(7),a=n(u),i=r(6),o=n(i),d=r(1),f=n(d),s=r(5),l=t.formatDate=function(e){if(!e||!String(e).trim())return null;var t=new Date(e),r=("0"+t.getDate()).substr(-2),n=("0"+(t.getMonth()+1)).substr(-2);return t.getFullYear()+"-"+n+"-"+r};t["default"]=function(e,t){var r={};return(0,f["default"])(e.fields).forEach(function(n){var u=t[n.toLowerCase()];e.fields[n]===s.DATE&&(u=l(u)),(0,o["default"])(r,(0,a["default"])({},n,u))}),r}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r(3),a=n(u),i=r(2),o=n(i),d=r(1),f=n(d),s=r(4);t["default"]=function(e,t){for(var r=arguments.length,n=Array(r>2?r-2:0),u=2;u<r;u++)n[u-2]=arguments[u];n&&n.length||(n=(0,f["default"])(t.fields));var i=(0,s.selectTable)();return i.from(t.table),n.forEach(function(e){return i.field(e)}),i.run=(0,o["default"])(a["default"].mark(function d(){var t,r;return a["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=i.values,r=i.toSQL(),n.abrupt("return",e.execute(r,t));case 3:case"end":return n.stop()}},d,void 0)})),i}},function(e,t){e.exports=require("babel-runtime/core-js/promise")},function(e,t){e.exports=require("babel-runtime/helpers/typeof")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r(11),a=n(u),i=r(3),o=n(i),d=r(2),f=n(d),s="BEGIN",l="COMMIT",c="ROLLBACK",p=function(){var e=(0,f["default"])(o["default"].mark(function t(e){var r,n;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.connect();case 2:if(r=t.sent,n=r.errno,!n){t.next=6;break}throw new Error(r.message);case 6:return t.abrupt("return",r);case 7:case"end":return t.stop()}},t,void 0)}));return function(t){return e.apply(this,arguments)}}(),v=function(e,t){var r=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];return new a["default"](function(n,u){e.query(t,r,function(e,t){return e?u(e):void n(t)})})};t["default"]=function(){var e=(0,f["default"])(o["default"].mark(function t(e){var r,n;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p(e);case 2:return r=t.sent,n={release:function(){var e=(0,f["default"])(o["default"].mark(function t(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.release());case 1:case"end":return e.stop()}},t,void 0)}));return function(){return e.apply(this,arguments)}}(),execute:v.bind(void 0,r),commit:function(){var e=(0,f["default"])(o["default"].mark(function t(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(r,l);case 2:return e.abrupt("return",n);case 3:case"end":return e.stop()}},t,void 0)}));return function(){return e.apply(this,arguments)}}(),rollback:function(){var e=(0,f["default"])(o["default"].mark(function t(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(r,c);case 2:return e.abrupt("return",n);case 3:case"end":return e.stop()}},t,void 0)}));return function(){return e.apply(this,arguments)}}(),startTransaction:function(){var e=(0,f["default"])(o["default"].mark(function t(){return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(r,s);case 2:return e.abrupt("return",n);case 3:case"end":return e.stop()}},t,void 0)}));return function(){return e.apply(this,arguments)}}()},t.abrupt("return",n);case 5:case"end":return t.stop()}},t,void 0)}));return function(t){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r(12),a=n(u),i=r(5),o="\n",d=function(e,t,r,n,u,o){var d=t.adds,f="",s="";return u&&(f=" NOT NULL"),void 0!==o&&(s=["boolean","number",""].indexOf("undefined"==typeof o?"undefined":(0,a["default"])(o))>-1?" DEFAULT "+String(o).toUpperCase():" DEFAULT '"+o+"'"),d.push("ADD COLUMN "+r+" "+(n===i.REFERENCES?i.INTEGER:n)+f+s),e},f=function(e,t,r){var n=t.drops;return n.push("DROP COLUMN "+r+" RESTRICT"),e},s=function(e,t,r){var n=t.alters;return n.push("ALTER COLUMN "+r+" DROP DEFAULT"),e},l=function(e,t,r,n){var u=t.alters,i="";return void 0!==n&&(i=["boolean","number",""].indexOf("undefined"==typeof n?"undefined":(0,a["default"])(n))>-1?""+String(n).toUpperCase():"'"+n+"'"),u.push("ALTER COLUMN "+r+" SET DEFAULT "+i),e},c=function(e){var t=e.tableName,r=e.adds,n=e.alters,u=e.drops,a=e.indexs;return("\nALTER TABLE "+t+" (\n  "+r.concat(n,u,a).join(","+o+"  ")+"\n);\n").trim()},p=function(e,t,r,n){var u=t.alters;return u.push("ALTER COLUMN "+r+" TYPE "+(n===i.REFERENCES?i.INTEGER:n)),e},v=function(e,t,r){var n=t.alters;return n.push("ALTER COLUMN "+r+" DROP NOT NULL"),e},b=function(e,t,r){var n=t.alters;return n.push("ALTER COLUMN "+r+" SET NOT NULL"),e},h=function(e,t,r,n){var u=t.alters;return u.push("RENAME COLUMN "+r+" TO "+n),e},E=function(e,t,r){var n=t.tableName,u=t.indexs;return u.push("ADD CONSTRAINT unique_"+n+"_"+r+" UNIQUE ("+r+")"),e},m=function(e,t,r){var n=t.tableName,u=t.indexs;return u.push("DROP CONSTRAINT unique_"+n+"_"+r),e},T=function(e,t,r,n,u){var a=t.tableName,i=t.indexs;return i.push("ADD CONSTRAINT foreign_"+a+"_"+r+" FOREIGN KEY ("+r+") REFERENCES "+n+" ("+(u?u:"id")+")"),e},x=function(e,t,r){var n=t.tableName,u=t.indexs;return u.push("DROP CONSTRAINT foreign_"+n+"_"+r),e};t["default"]=function(e){var t={tableName:e,adds:[],drops:[],alters:[],indexs:[]},r={};return r.toSQL=c.bind(void 0,t),r.setType=p.bind(void 0,r,t),r.addColumn=d.bind(void 0,r,t),r.addUnique=E.bind(void 0,r,t),r.dropUnique=m.bind(void 0,r,t),r.dropColumn=f.bind(void 0,r,t),r.setDefault=l.bind(void 0,r,t),r.setNotNull=b.bind(void 0,r,t),r.dropNotNull=v.bind(void 0,r,t),r.dropDefault=s.bind(void 0,r,t),r.renameColumn=h.bind(void 0,r,t),r.addForeign=T.bind(void 0,r,t),r.dropForeign=x.bind(void 0,r,t),r}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r(12),a=n(u),i=r(5),o="\n",d=function(e,t,r,n,u,o){var d=t.columns,f="",s="";return u&&(f=" NOT NULL"),void 0!==o&&(s=["boolean","number",""].indexOf("undefined"==typeof o?"undefined":(0,a["default"])(o))>-1?" DEFAULT "+String(o).toUpperCase():" DEFAULT '"+o+"'"),d.push(r+" "+(n===i.REFERENCES?i.INTEGER:n)+f+s),e},f=function(e,t,r){var n=t.tableName,u=t.uniques;return u.push("CONSTRAINT unique_"+n+"_"+r+" UNIQUE ("+r+")"),e},s=function(e,t,r,n,u){var a=t.tableName,i=t.foreigns;return i.push("CONSTRAINT foreign_"+a+"_"+r+" FOREIGN KEY ("+r+") REFERENCES "+n+" ("+(u?u:"id")+")"),e},l=function(e){var t=e.tableName,r=e.columns,n=e.uniques,u=e.foreigns;return("\nCREATE TABLE "+t+" (\n  "+r.concat(n,u).join(","+o+"  ")+"\n);\n").trim()};t["default"]=function(e){var t={tableName:e,columns:[],uniques:[],foreigns:[]},r={};return r.toSQL=l.bind(void 0,t),r.unique=f.bind(void 0,r,t),r.column=d.bind(void 0,r,t),r.foreign=s.bind(void 0,r,t),r}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r(1),a=n(u),i=r(8),o=n(i),d="\n",f=function(e){var t=e.schema,r=e.conditions,n=t.table,u=t.fields,i=r&&r.length?d+"WHERE ("+r.join(")"+d+"  AND (")+")":"";return("\nDELETE FROM "+n+i+"\nRETURNING "+(0,a["default"])(u).join(", ")+";\n").trim()},s=function(e,t){return e.values=[],e.conditions=(0,a["default"])(t||{}).map(function(r,n){var u=(0,o["default"])(t[r]),a=u.comparator,i=u.value;return e.values.push(i),r+" "+a+" $"+(n+1)}),e};t["default"]=function(e){var t={schema:e,values:[],conditions:[]};return t.toSQL=f.bind(void 0,t),t.objValues=s.bind(void 0,t),t}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return("\nDROP TABLE "+e+";\n").trim()};t["default"]=function(e){var t={};return t.toSQL=r.bind(void 0,e),t}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r(1),a=n(u),i=function(e){var t=e.schema,r=e.listFields,n=e.paramters,u=t.table,i=t.fields;return("\nINSERT INTO "+u+" ("+r.join(", ")+")\nVALUES ("+n.join(", ")+")\nRETURNING "+(0,a["default"])(i).join(", ")+";\n").trim()},o=function(e,t){var r=e.schema,n=r.fields;return e.listFields=(0,a["default"])(t).filter(function(e){return n.hasOwnProperty(e)&&void 0!==t[e]}),e.values=e.listFields.map(function(e){return t[e]}),e.paramters=e.listFields.map(function(e,t){return"$"+(t+1)}),e};t["default"]=function(e){var t={schema:e,values:{}};return t.toSQL=i.bind(void 0,t),t.objValues=o.bind(void 0,t),t}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r(1),a=n(u),i=r(6),o=n(i),d=r(8),f=n(d),s="\n",l=function(e,t,r){return r||(r=""),e.order.push((t+" "+r.toUpperCase()).trim()),e},c=function(e,t){return e.fields.push(t),e},p=function(e,t){return e.group.push(t),e},v=function(e,t){return e.joins.push(t),e},b=function(e,t){return(0,o["default"])(e,{tableName:t})},h=function(e,t){return(0,o["default"])(e,{limitRows:t})},E=function(e,t){return(0,o["default"])(e,{skipRows:t})},m=function R(e,t){var r=arguments.length<=2||void 0===arguments[2]?{c:0}:arguments[2];return(0,a["default"])(e).map(function(n){var u=e[n];if("$or"===n.toLowerCase())return"("+R(u,t,r).join(") OR (")+")";r.c++;var a=(0,f["default"])(u),i=a.comparator,o=a.value;return t.push(o),n+" "+i+" $"+r.c})},T=function(e,t){return t||(t={}),e.conditions=m(t,e.values),e},x=function(e){var t=e.tableName,r=e.fields,n=e.order,u=e.group,a=e.conditions,i=e.limitRows,o=e.skipRows,d=e.joins,f=o?s+"OFFSET "+o:"",l=i?s+"LIMIT "+i:"",c=n&&n.length?s+"ORDER BY "+n.join(", "):"",p=u&&u.length?s+"GROUP BY "+u.join(", "):"",v=a&&a.length?s+"WHERE ("+a.join(")"+s+"  AND (")+")":"",b=d&&d.length?""+s+d.join(s):"";return("\nSELECT "+r.join(", ")+"\nFROM "+t+b+v+p+c+l+f+"\n  ").trim()};t["default"]=function(){var e={tableName:"",fields:[],order:[],group:[],values:[],joins:[]};return e.from=b.bind(void 0,e),e.join=v.bind(void 0,e),e.skip=E.bind(void 0,e),e.limit=h.bind(void 0,e),e.field=c.bind(void 0,e),e.toSQL=x.bind(void 0,e),e.where=T.bind(void 0,e),e.orderBy=l.bind(void 0,e),e.groupBy=p.bind(void 0,e),e}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r(1),a=n(u),i=r(8),o=n(i),d="\n",f=function(e){var t=e.schema,r=e.paramters,n=e.conditions,u=t.table,i=t.fields,o=n&&n.length?d+"WHERE ("+n.join(")"+d+"  AND (")+")":"";return("\nUPDATE "+u+" SET\n  "+r.join(","+d+"  ")+o+"\nRETURNING "+(0,a["default"])(i).join(", ")+";\n").trim()},s=function(e,t,r){var n=e.schema,u=n.fields,i=(0,a["default"])(t).filter(function(e){return u.hasOwnProperty(e)&&void 0!==t[e]});return e.values=i.map(function(e){return t[e]}),e.paramters=i.map(function(e,t){return e+" = $"+(t+1)}),e.conditions=(0,a["default"])(r||{}).map(function(t,n){var u=(0,o["default"])(r[t]),a=u.comparator,d=u.value;return e.values.push(d),t+" "+a+" $"+(i.length+n+1)}),e};t["default"]=function(e){var t={schema:e,values:[],conditions:[]};return t.toSQL=f.bind(void 0,t),t.objValues=s.bind(void 0,t),t}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r(3),a=n(u),i=r(2),o=n(i),d=r(4),f=r(9),s=n(f);t["default"]=function(){var e=(0,o["default"])(a["default"].mark(function t(e,r,n){var u,i,o,f,l;return a["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return u=(0,d.deleteTable)(r).objValues(n),i=u.values,o=u.toSQL(),t.next=5,e.execute(o,i);case 5:if(f=t.sent,l=f.rows,l&&l.length){t.next=9;break}return t.abrupt("return",void 0);case 9:return t.abrupt("return",l.map(s["default"].bind(void 0,r)).shift());case 10:case"end":return t.stop()}},t,void 0)}));return function(t,r,n){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r(27),a=n(u),i=r(3),o=n(i),d=r(7),f=n(d),s=r(1),l=n(s),c=r(11),p=n(c),v=r(2),b=n(v),h=r(10),E=n(h),m=r(9),T=n(m),x=function(){var e=(0,b["default"])(o["default"].mark(function t(e,r,n,u,a){var i;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=n.hasMany,t.next=3,p["default"].all((0,l["default"])(i||{}).map(function(){var t=(0,b["default"])(o["default"].mark(function n(t){var d,s,l,c,v,b,h;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return d=i[t],s=d.table,l=d.field,c=e[s],v=E["default"].bind(void 0,r,c),n.next=7,v("id").where((0,f["default"])({},l,u.id)).run();case 7:if(b=n.sent,h=b.rows,h&&h.length){n.next=11;break}return n.abrupt("return");case 11:return n.next=13,p["default"].all(h.map(function(t){var n=t.id;return N(e,r,c,n,a)}));case 13:u[t]=n.sent;case 14:case"end":return n.stop()}},n,void 0)}));return function(e){return t.apply(this,arguments)}}()));case 3:case"end":return t.stop()}},t,void 0)}));return function(t,r,n,u,a){return e.apply(this,arguments)}}(),R=function(){var e=(0,b["default"])(o["default"].mark(function t(e,r,n,u,i){var d;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return d=n.manyToMany,t.next=3,p["default"].all((0,l["default"])(d||{}).map(function(){var t=(0,b["default"])(o["default"].mark(function n(t){var s,c,v,h,m,T,x,R,w,O,_;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return s=d[t],c=s.table,v=s.primary,h=s.secondary,m=s.extraFields,T=s.schema,x=e[c],R=E["default"].bind(void 0,r,x),w=(0,l["default"])(m),n.next=11,R.apply(void 0,[h].concat((0,a["default"])(w))).where((0,f["default"])({},v,u.id)).run();case 11:if(O=n.sent,_=O.rows,_&&_.length){n.next=15;break}return n.abrupt("return");case 15:return n.next=17,p["default"].all(_.map(function(){var t=(0,b["default"])(o["default"].mark(function n(t){var u,a;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return u=t[h],n.next=3,N(e,r,e[T],u,i);case 3:return a=n.sent,w.forEach(function(e){return a[e]=t[e]}),n.abrupt("return",a);case 6:case"end":return n.stop()}},n,void 0)}));return function(e){return t.apply(this,arguments)}}()));case 17:u[t]=n.sent;case 18:case"end":return n.stop()}},n,void 0)}));return function(e){return t.apply(this,arguments)}}()));case 3:case"end":return t.stop()}},t,void 0)}));return function(t,r,n,u,a){return e.apply(this,arguments)}}(),N=function(){var e=(0,b["default"])(o["default"].mark(function t(e,r,n,u){var a,i,d,f,s,l=arguments.length<=4||void 0===arguments[4]?{}:arguments[4];return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n.table+"-"+u,!l.hasOwnProperty(a)){t.next=3;break}return t.abrupt("return",l[a]);case 3:return i=E["default"].bind(void 0,r,n),t.next=6,i().where({id:u}).limit(1).run();case 6:if(d=t.sent,f=d.rows,f&&f.length){t.next=10;break}return t.abrupt("return",void 0);case 10:return s=f.map(T["default"].bind(void 0,n)).shift(),l[a]=s,t.next=14,x(e,r,n,s,l);case 14:return t.next=16,R(e,r,n,s,l);case 16:return t.abrupt("return",s);case 17:case"end":return t.stop()}},t,void 0)}));return function(t,r,n,u,a){return e.apply(this,arguments)}}(),w=function(){var e=(0,b["default"])(o["default"].mark(function t(e,r,n,u,a){var i,d,s,l,c;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=E["default"].bind(void 0,r,n),t.next=3,i("id").where((0,f["default"])({},u,a)).run();case 3:if(d=t.sent,s=d.rows,s&&s.length){t.next=7;break}return t.abrupt("return",[]);case 7:return l={},c=s.map(function(t){var u=t.id;return N(e,r,n,u,l)}),t.abrupt("return",p["default"].all(c));case 10:case"end":return t.stop()}},t,void 0)}));return function(t,r,n,u,a){return e.apply(this,arguments)}}(),O=function(e,t,r){var n={};return(0,l["default"])(r.fields).forEach(function(u){var a="findBy"+u.charAt(0).toUpperCase().concat(u.slice(1));return"id"===u?n[a]=N.bind(void 0,e,t,r):void(n[a]=w.bind(void 0,e,t,r,u))}),n};t["default"]=O},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var u=r(7),a=n(u),i=r(6),o=n(i),d=r(25),f=n(d),s=r(10),l=n(s),c=r(21),p=n(c),v=r(22),b=n(v),h=r(24),E=function T(e,t,r){var n=JSON.parse((0,f["default"])(e[r]));e[r].hasOwnProperty("afterSave")&&(n.afterSave=e[r].afterSave),e[r].hasOwnProperty("beforeSave")&&(n.beforeSave=e[r].beforeSave);var u=T.bind(void 0,e,t),a={schema:n};return a.select=l["default"].bind(void 0,t,n),a["delete"]=p["default"].bind(void 0,t,n),a.insert=h.insertData.bind(void 0,u,e,t,n),a.update=h.updateData.bind(void 0,u,e,t,n),(0,o["default"])(a,(0,b["default"])(e,t,n))},m=function(e,t){return E.bind(void 0,e,t)};t["default"]=function(e){var t={};return e.forEach(function(e){return(0,o["default"])(t,(0,a["default"])({},e.table,e))}),m.bind(void 0,t)}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.updateData=t.insertData=void 0;var u=r(3),a=n(u),i=r(7),o=n(i),d=r(6),f=n(d),s=r(26),l=n(s),c=r(1),p=n(c),v=r(11),b=n(v),h=r(2),E=n(h),m=r(4),T=r(10),x=n(T),R=r(9),N=n(R),w=function(){var e=(0,E["default"])(a["default"].mark(function t(e,r,n,u,i,d){var s,c=u.manyToMany;return a["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=i.id,t.abrupt("return",b["default"].all((0,p["default"])(c||{}).map(function(){var t=(0,E["default"])(a["default"].mark(function u(t){var v,h,m,T,R,N,w,O;return a["default"].wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(v=d[t],v&&v.length){u.next=3;break}return u.abrupt("return");case 3:return h=c[t],m=h.table,T=h.primary,R=h.secondary,N=h.schema,w=h.extraFields,O=r[N],u.next=12,b["default"].all(v.map(function(t,u){var a=(0,l["default"])({},t);(0,p["default"])(w).forEach(function(e){return delete a[e]});var i=a.id;return i?A(e,r,n,O,a,{id:i}):y(e,r,n,O,a)}));case 12:return i[t]=u.sent,u.next=15,b["default"].all(v.map(function(){var u=(0,E["default"])(a["default"].mark(function d(u,l){var c,v,b,h,E,N,O,_;return a["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return v={},(0,p["default"])(w).forEach(function(e){return v[e]=u[e]}),b=i[t][l].id,v[T]=s,v[R]=b,h=x["default"].bind(void 0,n,r[m]),a.next=8,h("id").from("kinships").where((c={},(0,o["default"])(c,T,s),(0,o["default"])(c,R,b),c)).limit(1).run();case 8:if(E=a.sent,N=E.rows,O=N&&N.length?N.shift().id:void 0,!O){a.next=17;break}return a.next=14,A(e,r,n,r[m],v,{id:O});case 14:a.t0=a.sent,a.next=20;break;case 17:return a.next=19,y(e,r,n,r[m],v);case 19:a.t0=a.sent;case 20:_=a.t0,(0,p["default"])(w).forEach(function(e){return(0,f["default"])(i[t][l],(0,o["default"])({},e,_[e]))});case 22:case"end":return a.stop()}},d,void 0)}));return function(e,t){return u.apply(this,arguments)}}()));case 15:case"end":return u.stop()}},u,void 0)}));return function(e){return t.apply(this,arguments)}}())));case 2:case"end":return t.stop()}},t,void 0)}));return function(t,r,n,u,a,i){return e.apply(this,arguments)}}(),O=function(){var e=(0,E["default"])(a["default"].mark(function t(e,r,n,u,i,d){var f,s=u.hasMany;return a["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return f=i.id,t.next=3,b["default"].all((0,p["default"])(s||{}).map(function(){var t=(0,E["default"])(a["default"].mark(function u(t){var c,p,v,h,E;return a["default"].wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(c=d[t],c&&c.length){u.next=3;break}return u.abrupt("return");case 3:return p=s[t],v=p.table,h=p.field,E=r[v],u.next=9,b["default"].all(c.map(function(t,u){var a=(0,l["default"])({},t,(0,o["default"])({},h,f)),i=a.id;return i?A(e,r,n,E,a,{id:i}):y(e,r,n,E,a)}));case 9:i[t]=u.sent;case 10:case"end":return u.stop()}},u,void 0)}));return function(e){return t.apply(this,arguments)}}()));case 3:case"end":return t.stop()}},t,void 0)}));return function(t,r,n,u,a,i){return e.apply(this,arguments)}}(),_=function(){var e=(0,E["default"])(a["default"].mark(function t(e,r,n,u,i,o){return a["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,O(e,r,n,u,i,o);case 2:return t.next=4,w(e,r,n,u,i,o);case 4:return t.abrupt("return",i);case 5:case"end":return t.stop()}},t,void 0)}));return function(t,r,n,u,a,i){return e.apply(this,arguments)}}(),y=t.insertData=function(){var e=(0,E["default"])(a["default"].mark(function t(e,r,n,u,i){var o,d,f,s,l,c,v,b,h;return a["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=void 0,!u.hasOwnProperty("beforeSave")){t.next=5;break}return t.next=4,u.beforeSave(i,e(u.table),e);case 4:o=t.sent;case 5:return o&&(0,p["default"])(o).length&&(i=o),d=(0,m.insertTable)(u).objValues(i),f=d.values,s=d.toSQL(),t.next=11,n.execute(s,f);case 11:if(l=t.sent,c=l.rows,c&&c.length){t.next=15;break}return t.abrupt("return",void 0);case 15:if(v=c.map(N["default"].bind(void 0,u)).shift(),b=void 0,!u.hasOwnProperty("afterSave")){t.next=21;break}return t.next=20,u.afterSave(v,e(u.table),e);case 20:b=t.sent;case 21:return b&&b.id&&(v=b),t.next=24,_(e,r,n,u,v,i);case 24:return h=t.sent,u.ignoreFields&&u.ignoreFields.forEach(function(e){return delete h[e]}),t.abrupt("return",h);case 27:case"end":return t.stop()}},t,void 0)}));return function(t,r,n,u,a){return e.apply(this,arguments)}}(),A=t.updateData=function(){var e=(0,E["default"])(a["default"].mark(function t(e,r,n,u,i,o){var d,f,s,l,c,v,b,h,E;return a["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(d=void 0,!u.hasOwnProperty("beforeSave")){t.next=5;break}return t.next=4,u.beforeSave(i,e(u.table),e);case 4:d=t.sent;case 5:return d&&(0,p["default"])(d).length&&(i=d),f=(0,m.updateTable)(u).objValues(i,o),s=f.values,l=f.toSQL(),t.next=11,n.execute(l,s);case 11:if(c=t.sent,v=c.rows,v&&v.length){t.next=15;break}return t.abrupt("return",void 0);case 15:if(b=v.map(N["default"].bind(void 0,u)).shift(),h=void 0,!u.hasOwnProperty("afterSave")){t.next=21;break}return t.next=20,u.afterSave(b,e(u.table),e);case 20:h=t.sent;case 21:return h&&h.id&&(b=h),t.next=24,_(e,r,n,u,b,i);case 24:return E=t.sent,u.ignoreFields&&u.ignoreFields.forEach(function(e){return delete E[e]}),t.abrupt("return",E);case 27:case"end":return t.stop()}},t,void 0)}));return function(t,r,n,u,a,i){return e.apply(this,arguments)}}()},function(e,t){e.exports=require("babel-runtime/core-js/json/stringify")},function(e,t){e.exports=require("babel-runtime/helpers/extends")},function(e,t){e.exports=require("babel-runtime/helpers/toConsumableArray")},function(e,t){e.exports=require("pg")}]);
//# sourceMappingURL=q-postgres.js.map